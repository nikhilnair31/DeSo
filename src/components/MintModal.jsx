import React, { useEffect, useState } from 'react';
import { ethers } from 'ethers';
import { pinFileToIPFS, pinJSONToIPFS, textToImage } from '../helpers/pinata'
import Spinner from './Spinner';
import './MintModal.scss';

const contractabi = {
    "_format": "hh-sol-artifact-1",
    "contractName": "PostMint",
    "sourceName": "contracts/PostMint.sol",
    "abi": [
      {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "approved",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "Approval",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "operator",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "bool",
            "name": "approved",
            "type": "bool"
          }
        ],
        "name": "ApprovalForAll",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "previousOwner",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "newOwner",
            "type": "address"
          }
        ],
        "name": "OwnershipTransferred",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "indexed": true,
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "Transfer",
        "type": "event"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "approve",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          }
        ],
        "name": "balanceOf",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "getApproved",
        "outputs": [
          {
            "internalType": "address",
            "name": "",
            "type": "address"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "owner",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "operator",
            "type": "address"
          }
        ],
        "name": "isApprovedForAll",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "string",
            "name": "uri",
            "type": "string"
          }
        ],
        "name": "isContentOwned",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "name",
        "outputs": [
          {
            "internalType": "string",
            "name": "",
            "type": "string"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "owner",
        "outputs": [
          {
            "internalType": "address",
            "name": "",
            "type": "address"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "ownerOf",
        "outputs": [
          {
            "internalType": "address",
            "name": "",
            "type": "address"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "recipient",
            "type": "address"
          },
          {
            "internalType": "string",
            "name": "metadataURI",
            "type": "string"
          }
        ],
        "name": "payToMint",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "payable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "renounceOwnership",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "string",
            "name": "uri",
            "type": "string"
          }
        ],
        "name": "safeMint",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "safeTransferFrom",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          },
          {
            "internalType": "bytes",
            "name": "_data",
            "type": "bytes"
          }
        ],
        "name": "safeTransferFrom",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "operator",
            "type": "address"
          },
          {
            "internalType": "bool",
            "name": "approved",
            "type": "bool"
          }
        ],
        "name": "setApprovalForAll",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "bytes4",
            "name": "interfaceId",
            "type": "bytes4"
          }
        ],
        "name": "supportsInterface",
        "outputs": [
          {
            "internalType": "bool",
            "name": "",
            "type": "bool"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "symbol",
        "outputs": [
          {
            "internalType": "string",
            "name": "",
            "type": "string"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "tokenURI",
        "outputs": [
          {
            "internalType": "string",
            "name": "",
            "type": "string"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "from",
            "type": "address"
          },
          {
            "internalType": "address",
            "name": "to",
            "type": "address"
          },
          {
            "internalType": "uint256",
            "name": "tokenId",
            "type": "uint256"
          }
        ],
        "name": "transferFrom",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "newOwner",
            "type": "address"
          }
        ],
        "name": "transferOwnership",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ],
    "bytecode": "0x60806040523480156200001157600080fd5b506040518060400160405280600881526020017f506f73744d696e740000000000000000000000000000000000000000000000008152506040518060400160405280600381526020017f504d540000000000000000000000000000000000000000000000000000000000815250816000908051906020019062000096929190620001a6565b508060019080519060200190620000af929190620001a6565b505050620000d2620000c6620000d860201b60201c565b620000e060201b60201c565b620002bb565b600033905090565b6000600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b828054620001b49062000256565b90600052602060002090601f016020900481019282620001d8576000855562000224565b82601f10620001f357805160ff191683800117855562000224565b8280016001018555821562000224579182015b828111156200022357825182559160200191906001019062000206565b5b50905062000233919062000237565b5090565b5b808211156200025257600081600090555060010162000238565b5090565b600060028204905060018216806200026f57607f821691505b602082108114156200028657620002856200028c565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b61343d80620002cb6000396000f3fe6080604052600436106101145760003560e01c8063715018a6116100a0578063b88d4fde11610064578063b88d4fde146103b6578063c87b56dd146103df578063d204c45e1461041c578063e985e9c514610445578063f2fde38b1461048257610114565b8063715018a6146102e35780638da5cb5b146102fa57806395d89b41146103255780639f1cabc614610350578063a22cb4651461038d57610114565b806323b872dd116100e757806323b872dd146101e757806342842e0e14610210578063615fd9e2146102395780636352211e1461026957806370a08231146102a657610114565b806301ffc9a71461011957806306fdde0314610156578063081812fc14610181578063095ea7b3146101be575b600080fd5b34801561012557600080fd5b50610140600480360381019061013b91906122bc565b6104ab565b60405161014d91906127a6565b60405180910390f35b34801561016257600080fd5b5061016b61058d565b60405161017891906127c1565b60405180910390f35b34801561018d57600080fd5b506101a860048036038101906101a3919061234f565b61061f565b6040516101b5919061273f565b60405180910390f35b3480156101ca57600080fd5b506101e560048036038101906101e09190612280565b6106a4565b005b3480156101f357600080fd5b5061020e60048036038101906102099190612126565b6107bc565b005b34801561021c57600080fd5b5061023760048036038101906102329190612126565b61081c565b005b610253600480360381019061024e919061222c565b61083c565b6040516102609190612a63565b60405180910390f35b34801561027557600080fd5b50610290600480360381019061028b919061234f565b610968565b60405161029d919061273f565b60405180910390f35b3480156102b257600080fd5b506102cd60048036038101906102c891906120c1565b610a1a565b6040516102da9190612a63565b60405180910390f35b3480156102ef57600080fd5b506102f8610ad2565b005b34801561030657600080fd5b5061030f610b5a565b60405161031c919061273f565b60405180910390f35b34801561033157600080fd5b5061033a610b84565b60405161034791906127c1565b60405180910390f35b34801561035c57600080fd5b506103776004803603810190610372919061230e565b610c16565b60405161038491906127a6565b60405180910390f35b34801561039957600080fd5b506103b460048036038101906103af91906121f0565b610c51565b005b3480156103c257600080fd5b506103dd60048036038101906103d89190612175565b610c67565b005b3480156103eb57600080fd5b506104066004803603810190610401919061234f565b610cc9565b60405161041391906127c1565b60405180910390f35b34801561042857600080fd5b50610443600480360381019061043e919061222c565b610cdb565b005b34801561045157600080fd5b5061046c600480360381019061046791906120ea565b610d88565b60405161047991906127a6565b60405180910390f35b34801561048e57600080fd5b506104a960048036038101906104a491906120c1565b610e1c565b005b60007f80ac58cd000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061057657507f5b5e139f000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b80610586575061058582610f14565b5b9050919050565b60606000805461059c90612cb9565b80601f01602080910402602001604051908101604052809291908181526020018280546105c890612cb9565b80156106155780601f106105ea57610100808354040283529160200191610615565b820191906000526020600020905b8154815290600101906020018083116105f857829003601f168201915b5050505050905090565b600061062a82610f7e565b610669576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161066090612963565b60405180910390fd5b6004600083815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b60006106af82610968565b90508073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610720576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610717906129e3565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff1661073f610fea565b73ffffffffffffffffffffffffffffffffffffffff16148061076e575061076d81610768610fea565b610d88565b5b6107ad576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107a4906128a3565b60405180910390fd5b6107b78383610ff2565b505050565b6107cd6107c7610fea565b826110ab565b61080c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161080390612a03565b60405180910390fd5b610817838383611189565b505050565b61083783838360405180602001604052806000815250610c67565b505050565b600060016009836040516108509190612704565b908152602001604051809103902060009054906101000a900460ff1660ff1614156108b0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108a790612a23565b60405180910390fd5b662386f26fc100003410156108fa576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108f190612a43565b60405180910390fd5b61090460086113e5565b600061091060086113fb565b905060016009846040516109249190612704565b908152602001604051809103902060006101000a81548160ff021916908360ff1602179055506109548482611409565b61095e81846115d7565b8091505092915050565b6000806002600084815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415610a11576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a08906128e3565b60405180910390fd5b80915050919050565b60008073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610a8b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a82906128c3565b60405180910390fd5b600360008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b610ada610fea565b73ffffffffffffffffffffffffffffffffffffffff16610af8610b5a565b73ffffffffffffffffffffffffffffffffffffffff1614610b4e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b4590612983565b60405180910390fd5b610b58600061164b565b565b6000600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b606060018054610b9390612cb9565b80601f0160208091040260200160405190810160405280929190818152602001828054610bbf90612cb9565b8015610c0c5780601f10610be157610100808354040283529160200191610c0c565b820191906000526020600020905b815481529060010190602001808311610bef57829003601f168201915b5050505050905090565b60006001600983604051610c2a9190612704565b908152602001604051809103902060009054906101000a900460ff1660ff16149050919050565b610c63610c5c610fea565b8383611711565b5050565b610c78610c72610fea565b836110ab565b610cb7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cae90612a03565b60405180910390fd5b610cc38484848461187e565b50505050565b6060610cd4826118da565b9050919050565b610ce3610fea565b73ffffffffffffffffffffffffffffffffffffffff16610d01610b5a565b73ffffffffffffffffffffffffffffffffffffffff1614610d57576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d4e90612983565b60405180910390fd5b6000610d6360086113fb565b9050610d6f60086113e5565b610d798382611a2c565b610d8381836115d7565b505050565b6000600560008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905092915050565b610e24610fea565b73ffffffffffffffffffffffffffffffffffffffff16610e42610b5a565b73ffffffffffffffffffffffffffffffffffffffff1614610e98576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e8f90612983565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415610f08576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610eff90612803565b60405180910390fd5b610f118161164b565b50565b60007f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b60008073ffffffffffffffffffffffffffffffffffffffff166002600084815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614159050919050565b600033905090565b816004600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550808273ffffffffffffffffffffffffffffffffffffffff1661106583610968565b73ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45050565b60006110b682610f7e565b6110f5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016110ec90612883565b60405180910390fd5b600061110083610968565b90508073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff16148061116f57508373ffffffffffffffffffffffffffffffffffffffff166111578461061f565b73ffffffffffffffffffffffffffffffffffffffff16145b80611180575061117f8185610d88565b5b91505092915050565b8273ffffffffffffffffffffffffffffffffffffffff166111a982610968565b73ffffffffffffffffffffffffffffffffffffffff16146111ff576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016111f6906129a3565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16141561126f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161126690612843565b60405180910390fd5b61127a838383611a4a565b611285600082610ff2565b6001600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546112d59190612bcf565b925050819055506001600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461132c9190612b48565b92505081905550816002600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550808273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a4505050565b6001816000016000828254019250508190555050565b600081600001549050919050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415611479576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161147090612923565b60405180910390fd5b61148281610f7e565b156114c2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016114b990612823565b60405180910390fd5b6114ce60008383611a4a565b6001600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461151e9190612b48565b92505081905550816002600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550808273ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a45050565b6115e082610f7e565b61161f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161161690612903565b60405180910390fd5b80600660008481526020019081526020016000209080519060200190611646929190611ee5565b505050565b6000600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415611780576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161177790612863565b60405180910390fd5b80600560008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c318360405161187191906127a6565b60405180910390a3505050565b611889848484611189565b61189584848484611a4f565b6118d4576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016118cb906127e3565b60405180910390fd5b50505050565b60606118e582610f7e565b611924576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161191b90612943565b60405180910390fd5b600060066000848152602001908152602001600020805461194490612cb9565b80601f016020809104026020016040519081016040528092919081815260200182805461197090612cb9565b80156119bd5780601f10611992576101008083540402835291602001916119bd565b820191906000526020600020905b8154815290600101906020018083116119a057829003601f168201915b5050505050905060006119ce611be6565b90506000815114156119e4578192505050611a27565b600082511115611a19578082604051602001611a0192919061271b565b60405160208183030381529060405292505050611a27565b611a2284611c23565b925050505b919050565b611a46828260405180602001604052806000815250611cca565b5050565b505050565b6000611a708473ffffffffffffffffffffffffffffffffffffffff16611d25565b15611bd9578373ffffffffffffffffffffffffffffffffffffffff1663150b7a02611a99610fea565b8786866040518563ffffffff1660e01b8152600401611abb949392919061275a565b602060405180830381600087803b158015611ad557600080fd5b505af1925050508015611b0657506040513d601f19601f82011682018060405250810190611b0391906122e5565b60015b611b89573d8060008114611b36576040519150601f19603f3d011682016040523d82523d6000602084013e611b3b565b606091505b50600081511415611b81576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611b78906127e3565b60405180910390fd5b805181602001fd5b63150b7a0260e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916817bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614915050611bde565b600190505b949350505050565b60606040518060400160405280600781526020017f697066733a2f2f00000000000000000000000000000000000000000000000000815250905090565b6060611c2e82610f7e565b611c6d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611c64906129c3565b60405180910390fd5b6000611c77611be6565b90506000815111611c975760405180602001604052806000815250611cc2565b80611ca184611d38565b604051602001611cb292919061271b565b6040516020818303038152906040525b915050919050565b611cd48383611409565b611ce16000848484611a4f565b611d20576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611d17906127e3565b60405180910390fd5b505050565b600080823b905060008111915050919050565b60606000821415611d80576040518060400160405280600181526020017f30000000000000000000000000000000000000000000000000000000000000008152509050611ee0565b600082905060005b60008214611db2578080611d9b90612d1c565b915050600a82611dab9190612b9e565b9150611d88565b60008167ffffffffffffffff811115611df4577f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6040519080825280601f01601f191660200182016040528015611e265781602001600182028036833780820191505090505b5090505b60008514611ed957600182611e3f9190612bcf565b9150600a85611e4e9190612d65565b6030611e5a9190612b48565b60f81b818381518110611e96577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350600a85611ed29190612b9e565b9450611e2a565b8093505050505b919050565b828054611ef190612cb9565b90600052602060002090601f016020900481019282611f135760008555611f5a565b82601f10611f2c57805160ff1916838001178555611f5a565b82800160010185558215611f5a579182015b82811115611f59578251825591602001919060010190611f3e565b5b509050611f679190611f6b565b5090565b5b80821115611f84576000816000905550600101611f6c565b5090565b6000611f9b611f9684612aa3565b612a7e565b905082815260208101848484011115611fb357600080fd5b611fbe848285612c77565b509392505050565b6000611fd9611fd484612ad4565b612a7e565b905082815260208101848484011115611ff157600080fd5b611ffc848285612c77565b509392505050565b600081359050612013816133ab565b92915050565b600081359050612028816133c2565b92915050565b60008135905061203d816133d9565b92915050565b600081519050612052816133d9565b92915050565b600082601f83011261206957600080fd5b8135612079848260208601611f88565b91505092915050565b600082601f83011261209357600080fd5b81356120a3848260208601611fc6565b91505092915050565b6000813590506120bb816133f0565b92915050565b6000602082840312156120d357600080fd5b60006120e184828501612004565b91505092915050565b600080604083850312156120fd57600080fd5b600061210b85828601612004565b925050602061211c85828601612004565b9150509250929050565b60008060006060848603121561213b57600080fd5b600061214986828701612004565b935050602061215a86828701612004565b925050604061216b868287016120ac565b9150509250925092565b6000806000806080858703121561218b57600080fd5b600061219987828801612004565b94505060206121aa87828801612004565b93505060406121bb878288016120ac565b925050606085013567ffffffffffffffff8111156121d857600080fd5b6121e487828801612058565b91505092959194509250565b6000806040838503121561220357600080fd5b600061221185828601612004565b925050602061222285828601612019565b9150509250929050565b6000806040838503121561223f57600080fd5b600061224d85828601612004565b925050602083013567ffffffffffffffff81111561226a57600080fd5b61227685828601612082565b9150509250929050565b6000806040838503121561229357600080fd5b60006122a185828601612004565b92505060206122b2858286016120ac565b9150509250929050565b6000602082840312156122ce57600080fd5b60006122dc8482850161202e565b91505092915050565b6000602082840312156122f757600080fd5b600061230584828501612043565b91505092915050565b60006020828403121561232057600080fd5b600082013567ffffffffffffffff81111561233a57600080fd5b61234684828501612082565b91505092915050565b60006020828403121561236157600080fd5b600061236f848285016120ac565b91505092915050565b61238181612c03565b82525050565b61239081612c15565b82525050565b60006123a182612b05565b6123ab8185612b1b565b93506123bb818560208601612c86565b6123c481612e52565b840191505092915050565b60006123da82612b10565b6123e48185612b2c565b93506123f4818560208601612c86565b6123fd81612e52565b840191505092915050565b600061241382612b10565b61241d8185612b3d565b935061242d818560208601612c86565b80840191505092915050565b6000612446603283612b2c565b915061245182612e63565b604082019050919050565b6000612469602683612b2c565b915061247482612eb2565b604082019050919050565b600061248c601c83612b2c565b915061249782612f01565b602082019050919050565b60006124af602483612b2c565b91506124ba82612f2a565b604082019050919050565b60006124d2601983612b2c565b91506124dd82612f79565b602082019050919050565b60006124f5602c83612b2c565b915061250082612fa2565b604082019050919050565b6000612518603883612b2c565b915061252382612ff1565b604082019050919050565b600061253b602a83612b2c565b915061254682613040565b604082019050919050565b600061255e602983612b2c565b91506125698261308f565b604082019050919050565b6000612581602e83612b2c565b915061258c826130de565b604082019050919050565b60006125a4602083612b2c565b91506125af8261312d565b602082019050919050565b60006125c7603183612b2c565b91506125d282613156565b604082019050919050565b60006125ea602c83612b2c565b91506125f5826131a5565b604082019050919050565b600061260d602083612b2c565b9150612618826131f4565b602082019050919050565b6000612630602983612b2c565b915061263b8261321d565b604082019050919050565b6000612653602f83612b2c565b915061265e8261326c565b604082019050919050565b6000612676602183612b2c565b9150612681826132bb565b604082019050919050565b6000612699603183612b2c565b91506126a48261330a565b604082019050919050565b60006126bc601383612b2c565b91506126c782613359565b602082019050919050565b60006126df600f83612b2c565b91506126ea82613382565b602082019050919050565b6126fe81612c6d565b82525050565b60006127108284612408565b915081905092915050565b60006127278285612408565b91506127338284612408565b91508190509392505050565b60006020820190506127546000830184612378565b92915050565b600060808201905061276f6000830187612378565b61277c6020830186612378565b61278960408301856126f5565b818103606083015261279b8184612396565b905095945050505050565b60006020820190506127bb6000830184612387565b92915050565b600060208201905081810360008301526127db81846123cf565b905092915050565b600060208201905081810360008301526127fc81612439565b9050919050565b6000602082019050818103600083015261281c8161245c565b9050919050565b6000602082019050818103600083015261283c8161247f565b9050919050565b6000602082019050818103600083015261285c816124a2565b9050919050565b6000602082019050818103600083015261287c816124c5565b9050919050565b6000602082019050818103600083015261289c816124e8565b9050919050565b600060208201905081810360008301526128bc8161250b565b9050919050565b600060208201905081810360008301526128dc8161252e565b9050919050565b600060208201905081810360008301526128fc81612551565b9050919050565b6000602082019050818103600083015261291c81612574565b9050919050565b6000602082019050818103600083015261293c81612597565b9050919050565b6000602082019050818103600083015261295c816125ba565b9050919050565b6000602082019050818103600083015261297c816125dd565b9050919050565b6000602082019050818103600083015261299c81612600565b9050919050565b600060208201905081810360008301526129bc81612623565b9050919050565b600060208201905081810360008301526129dc81612646565b9050919050565b600060208201905081810360008301526129fc81612669565b9050919050565b60006020820190508181036000830152612a1c8161268c565b9050919050565b60006020820190508181036000830152612a3c816126af565b9050919050565b60006020820190508181036000830152612a5c816126d2565b9050919050565b6000602082019050612a7860008301846126f5565b92915050565b6000612a88612a99565b9050612a948282612ceb565b919050565b6000604051905090565b600067ffffffffffffffff821115612abe57612abd612e23565b5b612ac782612e52565b9050602081019050919050565b600067ffffffffffffffff821115612aef57612aee612e23565b5b612af882612e52565b9050602081019050919050565b600081519050919050565b600081519050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b6000612b5382612c6d565b9150612b5e83612c6d565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115612b9357612b92612d96565b5b828201905092915050565b6000612ba982612c6d565b9150612bb483612c6d565b925082612bc457612bc3612dc5565b5b828204905092915050565b6000612bda82612c6d565b9150612be583612c6d565b925082821015612bf857612bf7612d96565b5b828203905092915050565b6000612c0e82612c4d565b9050919050565b60008115159050919050565b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b83811015612ca4578082015181840152602081019050612c89565b83811115612cb3576000848401525b50505050565b60006002820490506001821680612cd157607f821691505b60208210811415612ce557612ce4612df4565b5b50919050565b612cf482612e52565b810181811067ffffffffffffffff82111715612d1357612d12612e23565b5b80604052505050565b6000612d2782612c6d565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415612d5a57612d59612d96565b5b600182019050919050565b6000612d7082612c6d565b9150612d7b83612c6d565b925082612d8b57612d8a612dc5565b5b828206905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6000601f19601f8301169050919050565b7f4552433732313a207472616e7366657220746f206e6f6e20455243373231526560008201527f63656976657220696d706c656d656e7465720000000000000000000000000000602082015250565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b7f4552433732313a20746f6b656e20616c7265616479206d696e74656400000000600082015250565b7f4552433732313a207472616e7366657220746f20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b7f4552433732313a20617070726f766520746f2063616c6c657200000000000000600082015250565b7f4552433732313a206f70657261746f7220717565727920666f72206e6f6e657860008201527f697374656e7420746f6b656e0000000000000000000000000000000000000000602082015250565b7f4552433732313a20617070726f76652063616c6c6572206973206e6f74206f7760008201527f6e6572206e6f7220617070726f76656420666f7220616c6c0000000000000000602082015250565b7f4552433732313a2062616c616e636520717565727920666f7220746865207a6560008201527f726f206164647265737300000000000000000000000000000000000000000000602082015250565b7f4552433732313a206f776e657220717565727920666f72206e6f6e657869737460008201527f656e7420746f6b656e0000000000000000000000000000000000000000000000602082015250565b7f45524337323155524953746f726167653a2055524920736574206f66206e6f6e60008201527f6578697374656e7420746f6b656e000000000000000000000000000000000000602082015250565b7f4552433732313a206d696e7420746f20746865207a65726f2061646472657373600082015250565b7f45524337323155524953746f726167653a2055524920717565727920666f722060008201527f6e6f6e6578697374656e7420746f6b656e000000000000000000000000000000602082015250565b7f4552433732313a20617070726f76656420717565727920666f72206e6f6e657860008201527f697374656e7420746f6b656e0000000000000000000000000000000000000000602082015250565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b7f4552433732313a207472616e73666572206f6620746f6b656e2074686174206960008201527f73206e6f74206f776e0000000000000000000000000000000000000000000000602082015250565b7f4552433732314d657461646174613a2055524920717565727920666f72206e6f60008201527f6e6578697374656e7420746f6b656e0000000000000000000000000000000000602082015250565b7f4552433732313a20617070726f76616c20746f2063757272656e74206f776e6560008201527f7200000000000000000000000000000000000000000000000000000000000000602082015250565b7f4552433732313a207472616e736665722063616c6c6572206973206e6f74206f60008201527f776e6572206e6f7220617070726f766564000000000000000000000000000000602082015250565b7f4e465420616c7265616479206d696e7465642100000000000000000000000000600082015250565b7f4e65656420746f20706179207570210000000000000000000000000000000000600082015250565b6133b481612c03565b81146133bf57600080fd5b50565b6133cb81612c15565b81146133d657600080fd5b50565b6133e281612c21565b81146133ed57600080fd5b50565b6133f981612c6d565b811461340457600080fd5b5056fea2646970667358221220bc935054411e0ebfcd17d874dcbae5c54f5275e78cea6ae105aa9e0113ccccd964736f6c63430008040033",
    "deployedBytecode": "0x6080604052600436106101145760003560e01c8063715018a6116100a0578063b88d4fde11610064578063b88d4fde146103b6578063c87b56dd146103df578063d204c45e1461041c578063e985e9c514610445578063f2fde38b1461048257610114565b8063715018a6146102e35780638da5cb5b146102fa57806395d89b41146103255780639f1cabc614610350578063a22cb4651461038d57610114565b806323b872dd116100e757806323b872dd146101e757806342842e0e14610210578063615fd9e2146102395780636352211e1461026957806370a08231146102a657610114565b806301ffc9a71461011957806306fdde0314610156578063081812fc14610181578063095ea7b3146101be575b600080fd5b34801561012557600080fd5b50610140600480360381019061013b91906122bc565b6104ab565b60405161014d91906127a6565b60405180910390f35b34801561016257600080fd5b5061016b61058d565b60405161017891906127c1565b60405180910390f35b34801561018d57600080fd5b506101a860048036038101906101a3919061234f565b61061f565b6040516101b5919061273f565b60405180910390f35b3480156101ca57600080fd5b506101e560048036038101906101e09190612280565b6106a4565b005b3480156101f357600080fd5b5061020e60048036038101906102099190612126565b6107bc565b005b34801561021c57600080fd5b5061023760048036038101906102329190612126565b61081c565b005b610253600480360381019061024e919061222c565b61083c565b6040516102609190612a63565b60405180910390f35b34801561027557600080fd5b50610290600480360381019061028b919061234f565b610968565b60405161029d919061273f565b60405180910390f35b3480156102b257600080fd5b506102cd60048036038101906102c891906120c1565b610a1a565b6040516102da9190612a63565b60405180910390f35b3480156102ef57600080fd5b506102f8610ad2565b005b34801561030657600080fd5b5061030f610b5a565b60405161031c919061273f565b60405180910390f35b34801561033157600080fd5b5061033a610b84565b60405161034791906127c1565b60405180910390f35b34801561035c57600080fd5b506103776004803603810190610372919061230e565b610c16565b60405161038491906127a6565b60405180910390f35b34801561039957600080fd5b506103b460048036038101906103af91906121f0565b610c51565b005b3480156103c257600080fd5b506103dd60048036038101906103d89190612175565b610c67565b005b3480156103eb57600080fd5b506104066004803603810190610401919061234f565b610cc9565b60405161041391906127c1565b60405180910390f35b34801561042857600080fd5b50610443600480360381019061043e919061222c565b610cdb565b005b34801561045157600080fd5b5061046c600480360381019061046791906120ea565b610d88565b60405161047991906127a6565b60405180910390f35b34801561048e57600080fd5b506104a960048036038101906104a491906120c1565b610e1c565b005b60007f80ac58cd000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061057657507f5b5e139f000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b80610586575061058582610f14565b5b9050919050565b60606000805461059c90612cb9565b80601f01602080910402602001604051908101604052809291908181526020018280546105c890612cb9565b80156106155780601f106105ea57610100808354040283529160200191610615565b820191906000526020600020905b8154815290600101906020018083116105f857829003601f168201915b5050505050905090565b600061062a82610f7e565b610669576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161066090612963565b60405180910390fd5b6004600083815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b60006106af82610968565b90508073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610720576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610717906129e3565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff1661073f610fea565b73ffffffffffffffffffffffffffffffffffffffff16148061076e575061076d81610768610fea565b610d88565b5b6107ad576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107a4906128a3565b60405180910390fd5b6107b78383610ff2565b505050565b6107cd6107c7610fea565b826110ab565b61080c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161080390612a03565b60405180910390fd5b610817838383611189565b505050565b61083783838360405180602001604052806000815250610c67565b505050565b600060016009836040516108509190612704565b908152602001604051809103902060009054906101000a900460ff1660ff1614156108b0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108a790612a23565b60405180910390fd5b662386f26fc100003410156108fa576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108f190612a43565b60405180910390fd5b61090460086113e5565b600061091060086113fb565b905060016009846040516109249190612704565b908152602001604051809103902060006101000a81548160ff021916908360ff1602179055506109548482611409565b61095e81846115d7565b8091505092915050565b6000806002600084815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415610a11576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a08906128e3565b60405180910390fd5b80915050919050565b60008073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610a8b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a82906128c3565b60405180910390fd5b600360008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b610ada610fea565b73ffffffffffffffffffffffffffffffffffffffff16610af8610b5a565b73ffffffffffffffffffffffffffffffffffffffff1614610b4e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b4590612983565b60405180910390fd5b610b58600061164b565b565b6000600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b606060018054610b9390612cb9565b80601f0160208091040260200160405190810160405280929190818152602001828054610bbf90612cb9565b8015610c0c5780601f10610be157610100808354040283529160200191610c0c565b820191906000526020600020905b815481529060010190602001808311610bef57829003601f168201915b5050505050905090565b60006001600983604051610c2a9190612704565b908152602001604051809103902060009054906101000a900460ff1660ff16149050919050565b610c63610c5c610fea565b8383611711565b5050565b610c78610c72610fea565b836110ab565b610cb7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cae90612a03565b60405180910390fd5b610cc38484848461187e565b50505050565b6060610cd4826118da565b9050919050565b610ce3610fea565b73ffffffffffffffffffffffffffffffffffffffff16610d01610b5a565b73ffffffffffffffffffffffffffffffffffffffff1614610d57576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d4e90612983565b60405180910390fd5b6000610d6360086113fb565b9050610d6f60086113e5565b610d798382611a2c565b610d8381836115d7565b505050565b6000600560008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff16905092915050565b610e24610fea565b73ffffffffffffffffffffffffffffffffffffffff16610e42610b5a565b73ffffffffffffffffffffffffffffffffffffffff1614610e98576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e8f90612983565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415610f08576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610eff90612803565b60405180910390fd5b610f118161164b565b50565b60007f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b60008073ffffffffffffffffffffffffffffffffffffffff166002600084815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614159050919050565b600033905090565b816004600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550808273ffffffffffffffffffffffffffffffffffffffff1661106583610968565b73ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45050565b60006110b682610f7e565b6110f5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016110ec90612883565b60405180910390fd5b600061110083610968565b90508073ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff16148061116f57508373ffffffffffffffffffffffffffffffffffffffff166111578461061f565b73ffffffffffffffffffffffffffffffffffffffff16145b80611180575061117f8185610d88565b5b91505092915050565b8273ffffffffffffffffffffffffffffffffffffffff166111a982610968565b73ffffffffffffffffffffffffffffffffffffffff16146111ff576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016111f6906129a3565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16141561126f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161126690612843565b60405180910390fd5b61127a838383611a4a565b611285600082610ff2565b6001600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008282546112d59190612bcf565b925050819055506001600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461132c9190612b48565b92505081905550816002600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550808273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a4505050565b6001816000016000828254019250508190555050565b600081600001549050919050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415611479576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161147090612923565b60405180910390fd5b61148281610f7e565b156114c2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016114b990612823565b60405180910390fd5b6114ce60008383611a4a565b6001600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825461151e9190612b48565b92505081905550816002600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550808273ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a45050565b6115e082610f7e565b61161f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161161690612903565b60405180910390fd5b80600660008481526020019081526020016000209080519060200190611646929190611ee5565b505050565b6000600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415611780576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161177790612863565b60405180910390fd5b80600560008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c318360405161187191906127a6565b60405180910390a3505050565b611889848484611189565b61189584848484611a4f565b6118d4576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016118cb906127e3565b60405180910390fd5b50505050565b60606118e582610f7e565b611924576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161191b90612943565b60405180910390fd5b600060066000848152602001908152602001600020805461194490612cb9565b80601f016020809104026020016040519081016040528092919081815260200182805461197090612cb9565b80156119bd5780601f10611992576101008083540402835291602001916119bd565b820191906000526020600020905b8154815290600101906020018083116119a057829003601f168201915b5050505050905060006119ce611be6565b90506000815114156119e4578192505050611a27565b600082511115611a19578082604051602001611a0192919061271b565b60405160208183030381529060405292505050611a27565b611a2284611c23565b925050505b919050565b611a46828260405180602001604052806000815250611cca565b5050565b505050565b6000611a708473ffffffffffffffffffffffffffffffffffffffff16611d25565b15611bd9578373ffffffffffffffffffffffffffffffffffffffff1663150b7a02611a99610fea565b8786866040518563ffffffff1660e01b8152600401611abb949392919061275a565b602060405180830381600087803b158015611ad557600080fd5b505af1925050508015611b0657506040513d601f19601f82011682018060405250810190611b0391906122e5565b60015b611b89573d8060008114611b36576040519150601f19603f3d011682016040523d82523d6000602084013e611b3b565b606091505b50600081511415611b81576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611b78906127e3565b60405180910390fd5b805181602001fd5b63150b7a0260e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916817bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614915050611bde565b600190505b949350505050565b60606040518060400160405280600781526020017f697066733a2f2f00000000000000000000000000000000000000000000000000815250905090565b6060611c2e82610f7e565b611c6d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611c64906129c3565b60405180910390fd5b6000611c77611be6565b90506000815111611c975760405180602001604052806000815250611cc2565b80611ca184611d38565b604051602001611cb292919061271b565b6040516020818303038152906040525b915050919050565b611cd48383611409565b611ce16000848484611a4f565b611d20576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611d17906127e3565b60405180910390fd5b505050565b600080823b905060008111915050919050565b60606000821415611d80576040518060400160405280600181526020017f30000000000000000000000000000000000000000000000000000000000000008152509050611ee0565b600082905060005b60008214611db2578080611d9b90612d1c565b915050600a82611dab9190612b9e565b9150611d88565b60008167ffffffffffffffff811115611df4577f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6040519080825280601f01601f191660200182016040528015611e265781602001600182028036833780820191505090505b5090505b60008514611ed957600182611e3f9190612bcf565b9150600a85611e4e9190612d65565b6030611e5a9190612b48565b60f81b818381518110611e96577f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350600a85611ed29190612b9e565b9450611e2a565b8093505050505b919050565b828054611ef190612cb9565b90600052602060002090601f016020900481019282611f135760008555611f5a565b82601f10611f2c57805160ff1916838001178555611f5a565b82800160010185558215611f5a579182015b82811115611f59578251825591602001919060010190611f3e565b5b509050611f679190611f6b565b5090565b5b80821115611f84576000816000905550600101611f6c565b5090565b6000611f9b611f9684612aa3565b612a7e565b905082815260208101848484011115611fb357600080fd5b611fbe848285612c77565b509392505050565b6000611fd9611fd484612ad4565b612a7e565b905082815260208101848484011115611ff157600080fd5b611ffc848285612c77565b509392505050565b600081359050612013816133ab565b92915050565b600081359050612028816133c2565b92915050565b60008135905061203d816133d9565b92915050565b600081519050612052816133d9565b92915050565b600082601f83011261206957600080fd5b8135612079848260208601611f88565b91505092915050565b600082601f83011261209357600080fd5b81356120a3848260208601611fc6565b91505092915050565b6000813590506120bb816133f0565b92915050565b6000602082840312156120d357600080fd5b60006120e184828501612004565b91505092915050565b600080604083850312156120fd57600080fd5b600061210b85828601612004565b925050602061211c85828601612004565b9150509250929050565b60008060006060848603121561213b57600080fd5b600061214986828701612004565b935050602061215a86828701612004565b925050604061216b868287016120ac565b9150509250925092565b6000806000806080858703121561218b57600080fd5b600061219987828801612004565b94505060206121aa87828801612004565b93505060406121bb878288016120ac565b925050606085013567ffffffffffffffff8111156121d857600080fd5b6121e487828801612058565b91505092959194509250565b6000806040838503121561220357600080fd5b600061221185828601612004565b925050602061222285828601612019565b9150509250929050565b6000806040838503121561223f57600080fd5b600061224d85828601612004565b925050602083013567ffffffffffffffff81111561226a57600080fd5b61227685828601612082565b9150509250929050565b6000806040838503121561229357600080fd5b60006122a185828601612004565b92505060206122b2858286016120ac565b9150509250929050565b6000602082840312156122ce57600080fd5b60006122dc8482850161202e565b91505092915050565b6000602082840312156122f757600080fd5b600061230584828501612043565b91505092915050565b60006020828403121561232057600080fd5b600082013567ffffffffffffffff81111561233a57600080fd5b61234684828501612082565b91505092915050565b60006020828403121561236157600080fd5b600061236f848285016120ac565b91505092915050565b61238181612c03565b82525050565b61239081612c15565b82525050565b60006123a182612b05565b6123ab8185612b1b565b93506123bb818560208601612c86565b6123c481612e52565b840191505092915050565b60006123da82612b10565b6123e48185612b2c565b93506123f4818560208601612c86565b6123fd81612e52565b840191505092915050565b600061241382612b10565b61241d8185612b3d565b935061242d818560208601612c86565b80840191505092915050565b6000612446603283612b2c565b915061245182612e63565b604082019050919050565b6000612469602683612b2c565b915061247482612eb2565b604082019050919050565b600061248c601c83612b2c565b915061249782612f01565b602082019050919050565b60006124af602483612b2c565b91506124ba82612f2a565b604082019050919050565b60006124d2601983612b2c565b91506124dd82612f79565b602082019050919050565b60006124f5602c83612b2c565b915061250082612fa2565b604082019050919050565b6000612518603883612b2c565b915061252382612ff1565b604082019050919050565b600061253b602a83612b2c565b915061254682613040565b604082019050919050565b600061255e602983612b2c565b91506125698261308f565b604082019050919050565b6000612581602e83612b2c565b915061258c826130de565b604082019050919050565b60006125a4602083612b2c565b91506125af8261312d565b602082019050919050565b60006125c7603183612b2c565b91506125d282613156565b604082019050919050565b60006125ea602c83612b2c565b91506125f5826131a5565b604082019050919050565b600061260d602083612b2c565b9150612618826131f4565b602082019050919050565b6000612630602983612b2c565b915061263b8261321d565b604082019050919050565b6000612653602f83612b2c565b915061265e8261326c565b604082019050919050565b6000612676602183612b2c565b9150612681826132bb565b604082019050919050565b6000612699603183612b2c565b91506126a48261330a565b604082019050919050565b60006126bc601383612b2c565b91506126c782613359565b602082019050919050565b60006126df600f83612b2c565b91506126ea82613382565b602082019050919050565b6126fe81612c6d565b82525050565b60006127108284612408565b915081905092915050565b60006127278285612408565b91506127338284612408565b91508190509392505050565b60006020820190506127546000830184612378565b92915050565b600060808201905061276f6000830187612378565b61277c6020830186612378565b61278960408301856126f5565b818103606083015261279b8184612396565b905095945050505050565b60006020820190506127bb6000830184612387565b92915050565b600060208201905081810360008301526127db81846123cf565b905092915050565b600060208201905081810360008301526127fc81612439565b9050919050565b6000602082019050818103600083015261281c8161245c565b9050919050565b6000602082019050818103600083015261283c8161247f565b9050919050565b6000602082019050818103600083015261285c816124a2565b9050919050565b6000602082019050818103600083015261287c816124c5565b9050919050565b6000602082019050818103600083015261289c816124e8565b9050919050565b600060208201905081810360008301526128bc8161250b565b9050919050565b600060208201905081810360008301526128dc8161252e565b9050919050565b600060208201905081810360008301526128fc81612551565b9050919050565b6000602082019050818103600083015261291c81612574565b9050919050565b6000602082019050818103600083015261293c81612597565b9050919050565b6000602082019050818103600083015261295c816125ba565b9050919050565b6000602082019050818103600083015261297c816125dd565b9050919050565b6000602082019050818103600083015261299c81612600565b9050919050565b600060208201905081810360008301526129bc81612623565b9050919050565b600060208201905081810360008301526129dc81612646565b9050919050565b600060208201905081810360008301526129fc81612669565b9050919050565b60006020820190508181036000830152612a1c8161268c565b9050919050565b60006020820190508181036000830152612a3c816126af565b9050919050565b60006020820190508181036000830152612a5c816126d2565b9050919050565b6000602082019050612a7860008301846126f5565b92915050565b6000612a88612a99565b9050612a948282612ceb565b919050565b6000604051905090565b600067ffffffffffffffff821115612abe57612abd612e23565b5b612ac782612e52565b9050602081019050919050565b600067ffffffffffffffff821115612aef57612aee612e23565b5b612af882612e52565b9050602081019050919050565b600081519050919050565b600081519050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b6000612b5382612c6d565b9150612b5e83612c6d565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115612b9357612b92612d96565b5b828201905092915050565b6000612ba982612c6d565b9150612bb483612c6d565b925082612bc457612bc3612dc5565b5b828204905092915050565b6000612bda82612c6d565b9150612be583612c6d565b925082821015612bf857612bf7612d96565b5b828203905092915050565b6000612c0e82612c4d565b9050919050565b60008115159050919050565b60007fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b83811015612ca4578082015181840152602081019050612c89565b83811115612cb3576000848401525b50505050565b60006002820490506001821680612cd157607f821691505b60208210811415612ce557612ce4612df4565b5b50919050565b612cf482612e52565b810181811067ffffffffffffffff82111715612d1357612d12612e23565b5b80604052505050565b6000612d2782612c6d565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415612d5a57612d59612d96565b5b600182019050919050565b6000612d7082612c6d565b9150612d7b83612c6d565b925082612d8b57612d8a612dc5565b5b828206905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6000601f19601f8301169050919050565b7f4552433732313a207472616e7366657220746f206e6f6e20455243373231526560008201527f63656976657220696d706c656d656e7465720000000000000000000000000000602082015250565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b7f4552433732313a20746f6b656e20616c7265616479206d696e74656400000000600082015250565b7f4552433732313a207472616e7366657220746f20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b7f4552433732313a20617070726f766520746f2063616c6c657200000000000000600082015250565b7f4552433732313a206f70657261746f7220717565727920666f72206e6f6e657860008201527f697374656e7420746f6b656e0000000000000000000000000000000000000000602082015250565b7f4552433732313a20617070726f76652063616c6c6572206973206e6f74206f7760008201527f6e6572206e6f7220617070726f76656420666f7220616c6c0000000000000000602082015250565b7f4552433732313a2062616c616e636520717565727920666f7220746865207a6560008201527f726f206164647265737300000000000000000000000000000000000000000000602082015250565b7f4552433732313a206f776e657220717565727920666f72206e6f6e657869737460008201527f656e7420746f6b656e0000000000000000000000000000000000000000000000602082015250565b7f45524337323155524953746f726167653a2055524920736574206f66206e6f6e60008201527f6578697374656e7420746f6b656e000000000000000000000000000000000000602082015250565b7f4552433732313a206d696e7420746f20746865207a65726f2061646472657373600082015250565b7f45524337323155524953746f726167653a2055524920717565727920666f722060008201527f6e6f6e6578697374656e7420746f6b656e000000000000000000000000000000602082015250565b7f4552433732313a20617070726f76656420717565727920666f72206e6f6e657860008201527f697374656e7420746f6b656e0000000000000000000000000000000000000000602082015250565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b7f4552433732313a207472616e73666572206f6620746f6b656e2074686174206960008201527f73206e6f74206f776e0000000000000000000000000000000000000000000000602082015250565b7f4552433732314d657461646174613a2055524920717565727920666f72206e6f60008201527f6e6578697374656e7420746f6b656e0000000000000000000000000000000000602082015250565b7f4552433732313a20617070726f76616c20746f2063757272656e74206f776e6560008201527f7200000000000000000000000000000000000000000000000000000000000000602082015250565b7f4552433732313a207472616e736665722063616c6c6572206973206e6f74206f60008201527f776e6572206e6f7220617070726f766564000000000000000000000000000000602082015250565b7f4e465420616c7265616479206d696e7465642100000000000000000000000000600082015250565b7f4e65656420746f20706179207570210000000000000000000000000000000000600082015250565b6133b481612c03565b81146133bf57600080fd5b50565b6133cb81612c15565b81146133d657600080fd5b50565b6133e281612c21565b81146133ed57600080fd5b50565b6133f981612c6d565b811461340457600080fd5b5056fea2646970667358221220bc935054411e0ebfcd17d874dcbae5c54f5275e78cea6ae105aa9e0113ccccd964736f6c63430008040033",
    "linkReferences": {},
    "deployedLinkReferences": {}
}
const contractAddress = '0x5a951603fDaaBab6e9bC9149c2eCc15b1917E96c';
const provider = new ethers.providers.Web3Provider(window.ethereum);
const signer = provider.getSigner();
const contract = new ethers.Contract(contractAddress, contractabi.abi, signer);

const MintModal = (props) => {
    const [connectedtometamask, setconnectedtometamask] = useState(false);
    const [posting, setposting] = useState(false);
    const [balance, setBalance] = useState('');

    const connectToMetamask = async () => {
        const [account] = await window.ethereum.request({ method: 'eth_requestAccounts' });
        if(account){
            setconnectedtometamask(true);
        }
    };
    const getBalance = async () => {
        const [account] = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const balance = await provider.getBalance(account);
        setBalance(ethers.utils.formatEther(balance));
    };
    const mintToken = async () => {
        setposting(true);

        if(!props.file) {
            textToImage(props.newPostText).then( async (resp) => {
                console.log('resp: ', resp);
                let blob = new Blob(
                    [resp.data], 
                    { type: resp.headers['content-type'] }
                )
                console.log('textToImage blob: ', blob);
                props.setfile(blob);
                
                pinFileToIPFS(blob).then( async (resp) => {
                    console.log('resp: ', resp);
                    let respcid = resp.IpfsHash ? resp.IpfsHash : '';
                    // console.log('respcid: ', respcid);
                    
                    let metadatajson = {
                        'pinataMetadata': {
                            'name': `metadata-${props.newPostText}.json`
                        },
                        /* The contents of the "pinataContent" object will be added to IPFS */
                        /* The hash provided back will only represent the JSON contained in this object */
                        /* The JSON the returned hash links to will NOT contain the "pinataMetadata" object above */
                        /* The image URI include only the IPFS hash returned for the uploaded image */
                        'pinataContent': {
                            "image": `ipfs://${respcid}`,
                            "name": `${props.newPostText}`,
                            "description": `This is the NFT of the post made by ${props.currusername} on DeSo.`
                        }
                    }
    
                    pinJSONToIPFS(metadatajson).then( async (resp) => {
                        console.log('resp: ', resp);
                        let respcid = resp.IpfsHash ? resp.IpfsHash : '';
                        // console.log('respcid: ', respcid);
    
                        const signeraddr = await signer.getAddress();
                        console.log("signeraddr:", signeraddr);
    
                        const result = await contract.payToMint(signeraddr, respcid, {
                            value: ethers.utils.parseEther('0.01'),
                        });
                    
                        await result.wait();
                        getMintedStatus(respcid);
    
                        console.log('pinJSONToIPFS - ', true);
                        setposting(false);
                        props.pushPostbuttonClicked(true);
                        // getCount();
                    });
                });
            });
        }
        else {
            pinFileToIPFS(props.file).then( async (resp) => {
                console.log('resp: ', resp);
                let respcid = resp.IpfsHash ? resp.IpfsHash : '';
                // console.log('respcid: ', respcid);
                
                let metadatajson = {
                    'pinataMetadata': {
                        'name': `metadata-${props.filename}.json`
                    },
                    /* The contents of the "pinataContent" object will be added to IPFS */
                    /* The hash provided back will only represent the JSON contained in this object */
                    /* The JSON the returned hash links to will NOT contain the "pinataMetadata" object above */
                    /* The image URI include only the IPFS hash returned for the uploaded image */
                    'pinataContent': {
                        "image": `ipfs://${respcid}`,
                        "name": `${props.newPostText}`,
                        "description": `This is the NFT of the post made by ${props.currusername} on DeSo.`
                    }
                }

                pinJSONToIPFS(metadatajson).then( async (resp) => {
                    console.log('resp: ', resp);
                    let respcid = resp.IpfsHash ? resp.IpfsHash : '';
                    // console.log('respcid: ', respcid);

                    const signeraddr = await signer.getAddress();
                    console.log("signeraddr:", signeraddr);

                    const result = await contract.payToMint(signeraddr, respcid, {
                        value: ethers.utils.parseEther('0.01'),
                    });
                
                    await result.wait();
                    getMintedStatus(respcid);

                    console.log('pinJSONToIPFS - ', true);
                    setposting(false);
                    props.pushPostbuttonClicked(true);
                    // getCount();
                });
            });
        }
    };
    const getMintedStatus = async (respmetadataURI) => {
        const result = await contract.isContentOwned(respmetadataURI);
        console.log(result)
        props.close();
        // setIsMinted(result);
    };

    useEffect(() => { 
        if(connectedtometamask) getBalance();
        else connectToMetamask();
    }, [connectedtometamask]);

    return (
        <div className="mint_modal">
            <div className="header"> Minting And Posting </div>
            <div className="content"> On pressing 'Mint' wait for the process to complete please. </div>
            <br />
            <button className={"button connect_button "+(connectedtometamask ? 'connected' : '')} type="submit" disabled={connectedtometamask} onClick={connectToMetamask} >{(connectedtometamask ? 'Wallet Connected!\nBalance: '+balance.slice(0, 10) : 'Connect to MetaMask')}</button>
            <button className="button mint_button" onClick={mintToken}>Mint</button>
            <button className="button cancel_button" onClick ={props.close}>Cancel</button>
            { posting && <Spinner /> }
        </div>
    );
}

export default MintModal;